<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Plane Identifier</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
</head>
<body>
  <main class="ai-container">
    <h1>AI Plane Identifier</h1>
    <input type="file" id="imageUpload" accept="image/*" />
    <br><br>
    <img id="preview" style="max-width: 300px; display: none;" />
    <br><br>
    <button id="submitBtn">Submit</button>
    <div id="predictionResult" class="result-box"></div>
  </main>

  <script>
    const URL = "https://teachablemachine.withgoogle.com/models/kdYv2Y8pv/";
    let model, maxPredictions;

    const preview = document.getElementById("preview");
    const imageUpload = document.getElementById("imageUpload");
    const submitBtn = document.getElementById("submitBtn");
    const resultBox = document.getElementById("predictionResult");

    // Load the model
    async function loadModel() {
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";
      model = await tmImage.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();
    }

    // Preview image
    imageUpload.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (event) {
        preview.src = event.target.result;
        preview.style.display = "block";
      };
      reader.readAsDataURL(file);
    });

    // On submit, make prediction
    submitBtn.addEventListener("click", async () => {
      if (!preview.src || !model) {
        resultBox.innerHTML = "<p>Please upload an image and wait for model to load.</p>";
        return;
      }

      const prediction = await model.predict(preview);
      prediction.sort((a, b) => b.probability - a.probability);

      resultBox.innerHTML = `<h2>Prediction:</h2>
        <p><strong>${prediction[0].className}</strong> (${(prediction[0].probability * 100).toFixed(2)}%)</p>`;
    });

    // Load model when page loads
    window.addEventListener("load", loadModel);
  </script>
</body>
</html>
